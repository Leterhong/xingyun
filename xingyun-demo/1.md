å‰è¨€ï¼šæ•°å­—äººåˆè¦å˜å¤©äº†ï¼
å½“æˆ‘ä»¬è¿˜åœ¨æ„Ÿå¹ChatGPTå¸¦æ¥çš„AIé©å‘½æ—¶ï¼Œä¸€ä¸ªæ›´å…·é¢ è¦†æ€§çš„é—®é¢˜æ‘†åœ¨äº†é¢å‰ï¼šå¦‚æœAIä¸å†åªæ˜¯å†°å†·çš„æ–‡å­—å¯¹è¯ï¼Œè€Œæ˜¯æ‹¥æœ‰3Då½¢è±¡ã€èƒ½åšå‡ºè¡¨æƒ…åŠ¨ä½œã€å¯ä»¥åƒçœŸäººä¸€æ ·äº¤æµï¼Œä¼šæ˜¯ä»€ä¹ˆæ ·çš„ä½“éªŒ?
é­”çç§‘æŠ€ç»™å‡ºäº†ç­”æ¡ˆâ€”â€”é­”çæ˜Ÿäº‘ï¼Œä¸€ä¸ªè®©å¤§æ¨¡å‹æ‹¥æœ‰"èº«ä½“"çš„å…·èº«æ™ºèƒ½3Dæ•°å­—äººå¼€å‘å¹³å°ã€‚ç”¨å®˜æ–¹çš„è¯è¯´ï¼šæ˜Ÿäº‘ = å…·èº«æ™ºèƒ½çš„åŸºç¡€è®¾æ–½ã€‚è¿™ä¸æ˜¯ç®€å•çš„æ•°å­—äººå±•ç¤ºï¼Œè€Œæ˜¯çœŸæ­£è®©AIä»"èƒ½è¯´"è¿›åŒ–åˆ°"èƒ½åš"çš„é©å‘½æ€§çªç ´ã€‚
ä½œä¸ºä¸€åå¼€å‘è€…ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´ä½“éªŒäº†è¿™ä¸ªå¹³å°ï¼Œå¹¶è¢«å®ƒçš„æ˜“ç”¨æ€§å’Œå¼ºå¤§åŠŸèƒ½æ·±æ·±éœ‡æ’¼ã€‚ä»Šå¤©å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„å®Œæ•´æµ‹è¯„ä½“éªŒã€‚
æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹
ä¸€ã€é­”çæ˜Ÿäº‘æ˜¯ä»€ä¹ˆï¼Ÿæ ¸å¿ƒä»·å€¼åœ¨å“ªé‡Œï¼Ÿ
1.1 å¹³å°å®šä½
é­”çæ˜Ÿäº‘æ˜¯ä¸€ä¸ªå…·èº«æ™ºèƒ½3Dæ•°å­—äººå¼€å‘å¹³å°ï¼Œæ ¸å¿ƒä½¿å‘½æ˜¯è®©å¤§æ¨¡å‹ä¸å†åªæ˜¯æ–‡å­—æˆ–è¯­éŸ³è¾“å‡ºï¼Œè€Œæ˜¯æ‹¥æœ‰ï¼š
- 3Då½¢è±¡ï¼šç”µå½±çº§çš„æ•°å­—äººæ¸²æŸ“è´¨é‡
- å®æ—¶äº¤äº’ï¼šä½å»¶æ—¶ã€å¯éšæ—¶æ‰“æ–­
- å¤šæ¨¡æ€è¡¨è¾¾ï¼šè¯­éŸ³ã€è¡¨æƒ…ã€åŠ¨ä½œä¸‰ä½ä¸€ä½“
- åœºæ™¯é€‚é…ï¼šä»æ‰‹æœºåˆ°å¤§å±ï¼Œä»è½¦æœºåˆ°æœºå™¨äºº
ç®€å•æ¥è¯´ï¼Œæ˜Ÿäº‘è®©AIä»"èƒ½å¬ä¼šè¯´"å‡çº§ä¸º"èƒ½çœ‹ä¼šåš"ï¼Œè¿™æ˜¯å…·èº«æ™ºèƒ½æ—¶ä»£çš„iPhoneæ—¶åˆ»ã€‚
1.2 å…­å¤§æ ¸å¿ƒç‰¹ç‚¹
ç»è¿‡æ·±åº¦æµ‹è¯•ï¼Œæˆ‘æ€»ç»“å‡ºé­”çæ˜Ÿäº‘çš„å…­å¤§æ ¸å¿ƒä¼˜åŠ¿ï¼š
æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹
1.3 æŠ€æœ¯çªç ´ï¼šæ‰“ç ´"ä¸å¯èƒ½ä¸‰è§’"
ä¼ ç»Ÿ3Dæ•°å­—äººé¢ä¸´è´¨é‡ã€æˆæœ¬ã€å»¶æ—¶çš„ä¸å¯èƒ½ä¸‰è§’å›°å¢ƒï¼Œè€Œé­”çæ˜Ÿäº‘é€šè¿‡ï¼š
- æ–‡ç”Ÿ3Då¤šæ¨¡æ€åŠ¨ä½œå¤§æ¨¡å‹ï¼šAIè‡ªåŠ¨ç”Ÿæˆè¡¨æƒ…åŠ¨ä½œ
- ç«¯ä¾§æ¸²æŸ“æŠ€æœ¯ï¼šæ— éœ€äº‘ç«¯GPUï¼Œé™ä½æˆæœ¬
- AIç«¯è§£ç®—ï¼šå®æ—¶è®¡ç®—ï¼Œé™ä½å»¶æ—¶
çœŸæ­£å®ç°äº†ä¸‰è€…å…¼å¾—ï¼Œè¿™æ˜¯å…·èº«æ™ºèƒ½å¤§è§„æ¨¡åº”ç”¨çš„æŠ€æœ¯åŸºç¡€ã€‚
äºŒã€å¹³å°ä½¿ç”¨ä½“éªŒï¼šä»æ³¨å†Œåˆ°åº”ç”¨ä¸Šçº¿
2.1 æ³¨å†Œä¸å¼€é€š
é¦–å…ˆè¦è¯´çš„æ˜¯ï¼Œé­”çæ˜Ÿäº‘ç°å·²å…è´¹å¼€æ”¾ï¼è®¿é—®å®˜ç½‘å³å¯æ³¨å†Œ
æ³¨å†Œæµç¨‹éå¸¸ç®€å•ï¼š
1. è®¿é—®å®˜ç½‘ï¼Œç‚¹å‡»æ³¨å†Œ
2. å¡«å†™åŸºæœ¬ä¿¡æ¯
3. å¡«å†™éªŒè¯åå³å¯ç™»å½•
[å›¾ç‰‡]
ç™»å½•åè¿›å…¥æ§åˆ¶å°ï¼Œç•Œé¢æ¸…çˆ½
[å›¾ç‰‡]
2.2 åˆ›å»ºç¬¬ä¸€ä¸ªæ•°å­—äººåº”ç”¨
è¿›å…¥"åº”ç”¨ç®¡ç†"ï¼Œç‚¹å‡»"åˆ›å»ºæ–°åº”ç”¨"ï¼Œæµç¨‹å¦‚ä¸‹ï¼š
[å›¾ç‰‡]
æ­¥éª¤1ï¼šé€‰æ‹©æ•°å­—äººè§’è‰²
å¹³å°æä¾›äº†å¤šä¸ªé¢„è®¾è§’è‰²ï¼ŒåŒ…æ‹¬ï¼š
- ä¸“ä¸šå•†åŠ¡é£æ ¼ï¼ˆé€‚åˆå®¢æœã€å¯¼åŠï¼‰
- äº²å’Œé‚»å®¶é£æ ¼ï¼ˆé€‚åˆé™ªä¼´ã€æ•™è‚²ï¼‰
- æ—¶å°šæ½®æµé£æ ¼ï¼ˆé€‚åˆè¥é”€ã€å¨±ä¹ï¼‰
æˆ‘é€‰æ‹©äº†ä¸€ä¸ªå•†åŠ¡é£æ ¼çš„ç”·æ€§è§’è‰²ï¼Œç”¨äºåç»­çš„"BIåˆ†æå¸ˆ"åœºæ™¯æµ‹è¯•ã€‚
[å›¾ç‰‡]
æ­¥éª¤2ï¼šé…ç½®éŸ³è‰²
éŸ³è‰²åº“éå¸¸ä¸°å¯Œï¼Œæ”¯æŒï¼š
- ä¸åŒæ€§åˆ«ã€å¹´é¾„æ®µ
- ä¸åŒæƒ…æ„Ÿé£æ ¼ï¼ˆæ¸©æŸ”/æ´»æ³¼/ä¸“ä¸šï¼‰
- å¤šç§æ–¹è¨€å’Œå¤–è¯­
æˆ‘é€‰æ‹©äº†"ä¸“ä¸šç”·å£°"ï¼ŒéŸ³è´¨æ¸…æ™°ï¼Œè¯­é€Ÿé€‚ä¸­ã€‚
[å›¾ç‰‡]
æ­¥éª¤3ï¼šè®¾ç½®è¡¨æ¼”é£æ ¼
è¿™æ˜¯é­”çæ˜Ÿäº‘çš„ç‹¬ç‰¹åŠŸèƒ½ï¼Œå¯ä»¥è®¾ç½®æ•°å­—äººçš„ï¼š
- å¾…æœºåŠ¨ä½œï¼šidleçŠ¶æ€ä¸‹çš„å¾®åŠ¨ä½œ
- å€¾å¬çŠ¶æ€ï¼šç”¨æˆ·è¯´è¯æ—¶çš„ååº”
- è¯´è¯é£æ ¼ï¼šæ‰‹åŠ¿å¹…åº¦ã€è¡¨æƒ…ä¸°å¯Œåº¦
è°ƒæ•´åå®æ—¶é¢„è§ˆï¼Œéå¸¸ç›´è§‚ã€‚
[å›¾ç‰‡]
æ­¥éª¤4ï¼šè·å–å¯†é’¥
åˆ›å»ºå®Œæˆåï¼Œç‚¹å‡»"æŸ¥çœ‹å¯†é’¥"ï¼Œè·å¾—ï¼š
- App IDï¼šåº”ç”¨å”¯ä¸€æ ‡è¯†
- App Secretï¼šæ¥å£è°ƒç”¨å¯†é’¥
æ³¨æ„ï¼šå¯†é’¥åªæ˜¾ç¤ºä¸€æ¬¡ï¼ŒåŠ¡å¿…ä¿å­˜å¥½ï¼
[å›¾ç‰‡]
2.3 è°ƒè¯•ä¸æµ‹è¯•
åœ¨åº”ç”¨è¯¦æƒ…é¡µï¼Œæœ‰ä¸€ä¸ª"åœ¨çº¿è°ƒè¯•"åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•æ•°å­—äººæ•ˆæœï¼š
1. è¾“å…¥æ–‡æœ¬ï¼š"ä½ å¥½ï¼Œæˆ‘æ˜¯è·¯æ¼”æ•°å­—äººæ´ª"
2. ç‚¹å‡»"å‘é€"
3. æ•°å­—äººç«‹å³å¼€å§‹è¯´è¯ï¼Œè¡¨æƒ…ã€å£å‹ã€æ‰‹åŠ¿å®Œå…¨åŒæ­¥
æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹
ä¸‰ã€SDKæ¥å…¥å®æˆ˜ï¼šæ‰“é€ AI BIåˆ†æå¸ˆ
å…‰çœ‹æ•ˆæœä¸å¤Ÿï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘æ›´å…³å¿ƒæ¥å…¥éš¾åº¦ã€‚é­”çæ˜Ÿäº‘æä¾›äº†JS SDKå’ŒAndroid SDKï¼Œæˆ‘é€‰æ‹©äº†JSç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ã€‚
å…ˆç»™å¤§å®¶çœ‹çœ‹æˆ‘å·²ç»æ¥å…¥çš„æ•ˆæœ
æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹
æ”¯æŒæ–‡æœ¬å¯¹è¯å’Œè¯­éŸ³å¯¹è¯ï¼Œè¯­éŸ³å¯¹è¯éœ€è¦é…ç½®è¯­éŸ³è¯†åˆ«æœåŠ¡ã€‚
[å›¾ç‰‡]
3.1 é¡¹ç›®åˆå§‹åŒ–
3.1.1 åˆ›å»ºVue3é¡¹ç›®
é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨Viteåˆ›å»ºä¸€ä¸ªVue3 + TypeScripté¡¹ç›®ï¼š
# åˆ›å»ºé¡¹ç›®
npm create vite@latest xingyun-bi-analyst -- --template vue-ts
[å›¾ç‰‡]
å®‰è£…å¿…è¦ä¾èµ–
# è¿›å…¥é¡¹ç›®ç›®å½•
cd xingyun-bi-analyst

# å®‰è£…ä¾èµ–
npm install

# å®‰è£…UIç»„ä»¶åº“ï¼ˆä½¿ç”¨Element Plusï¼‰
npm install element-plus

# å®‰è£…å›¾æ ‡åº“
npm install @element-plus/icons-vue

# å®‰è£…åŠ å¯†åº“ï¼ˆç”¨äºASRé‰´æƒï¼‰
npm install crypto-js

# å®‰è£…ç±»å‹å®šä¹‰
npm install @types/crypto-js -D

# å®‰è£…Axiosï¼ˆç”¨äºHTTPè¯·æ±‚ï¼‰
npm install axios

# å®‰è£…EChartsï¼ˆç”¨äºæ•°æ®å¯è§†åŒ–ï¼‰
npm install echarts

[å›¾ç‰‡]

#### 3.1.2 å¼•å…¥é­”çæ˜Ÿäº‘SDK

åœ¨ `index.html` ä¸­å¼•å…¥SDKè„šæœ¬ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI BIåˆ†æå¸ˆ - é­”çæ˜Ÿäº‘</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
    
    <!-- å¼•å…¥é­”çæ˜Ÿäº‘SDK -->
    <script src="https://media.xingyun3d.com/xingyun3d/general/litesdk/xmovAvatar@latest.js"></script>
  </body>
</html>
```

**å…³é”®ç‚¹è§£é‡Š**ï¼š
- SDKé€šè¿‡CDNå¼•å…¥ï¼Œ`@latest`è‡ªåŠ¨è·å–æœ€æ–°ç‰ˆæœ¬
- å¿…é¡»åœ¨ `<body>` æ ‡ç­¾å†…å¼•å…¥ï¼Œç¡®ä¿DOMå·²åŠ è½½
- SDKä¼šåœ¨å…¨å±€æ³¨å†Œ `XmovAvatar` ç±»

---

### 3.2 é¡¹ç›®æ¶æ„è®¾è®¡

åœ¨æ­£å¼ç¼–ç å‰ï¼Œå…ˆè®¾è®¡å¥½é¡¹ç›®ç»“æ„ï¼Œè¿™æ˜¯ä¸“ä¸šå¼€å‘çš„ç¬¬ä¸€æ­¥ï¼š

```
xingyun-bi-analyst/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # ç»„ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ AvatarPanel.vue   # æ•°å­—äººå±•ç¤ºé¢æ¿
â”‚   â”‚   â”œâ”€â”€ ChatPanel.vue     # èŠå¤©å¯¹è¯é¢æ¿
â”‚   â”‚   â”œâ”€â”€ ControlPanel.vue  # æ§åˆ¶é¢æ¿
â”‚   â”‚   â””â”€â”€ SettingsForm.vue  # é…ç½®è¡¨å•
â”‚   â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ xingyun.ts        # æ˜Ÿäº‘SDKå°è£…
â”‚   â”‚   â”œâ”€â”€ llm.ts            # å¤§æ¨¡å‹æœåŠ¡
â”‚   â”‚   â””â”€â”€ asr.ts            # è¯­éŸ³è¯†åˆ«æœåŠ¡
â”‚   â”œâ”€â”€ App.vue              # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â””â”€â”€ main.ts              # å…¥å£æ–‡ä»¶
â”œâ”€â”€ index.html               # HTMLå…¥å£
â””â”€â”€ package.json             # é¡¹ç›®é…ç½®
```

**æ¶æ„è®¾è®¡æ€è·¯**ï¼š
1. **ç»„ä»¶åŒ–**ï¼šå°†UIæ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶ï¼Œä¾¿äºç»´æŠ¤
2. **æœåŠ¡åŒ–**ï¼šå°†ä¸šåŠ¡é€»è¾‘æŠ½ç¦»åˆ°serviceå±‚ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»
3. **ç±»å‹åŒ–**ï¼šä½¿ç”¨TypeScriptï¼Œæå‡ä»£ç è´¨é‡

---

### 3.3 æ ¸å¿ƒæœåŠ¡å°è£…

#### 3.3.1 æ˜Ÿäº‘SDKæœåŠ¡å°è£…

åˆ›å»º `src/services/xingyun.ts`ï¼Œå°è£…SDKçš„æ‰€æœ‰æ“ä½œï¼š

```typescript
// src/services/xingyun.ts
export interface XingyunConfig {
  containerId: string      // å®¹å™¨ID
  appId: string           // åº”ç”¨ID
  appSecret: string       // åº”ç”¨å¯†é’¥
  gatewayServer: string   // ç½‘å…³åœ°å€
  onMessage?: (message: any) => void        // æ¶ˆæ¯å›è°ƒ
  onStateChange?: (state: string) => void   // çŠ¶æ€å˜åŒ–å›è°ƒ
  onVoiceStateChange?: (status: string) => void  // è¯­éŸ³çŠ¶æ€å›è°ƒ
  onNetworkInfo?: (info: any) => void       // ç½‘ç»œä¿¡æ¯å›è°ƒ
}

export class XingyunService {
  private sdk: any = null
  private config: XingyunConfig

  constructor(config: XingyunConfig) {
    this.config = config
  }

  // åˆå§‹åŒ–SDK
  async init(options?: { onDownloadProgress?: (progress: number) => void }) {
    // æ£€æŸ¥SDKæ˜¯å¦å·²åŠ è½½
    if (!(window as any).XmovAvatar) {
      throw new Error('é­”çæ˜Ÿäº‘SDKæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥index.htmlä¸­çš„scriptæ ‡ç­¾')
    }

    // åˆ›å»ºSDKå®ä¾‹
    this.sdk = new (window as any).XmovAvatar({
      containerId: this.config.containerId,
      appId: this.config.appId,
      appSecret: this.config.appSecret,
      gatewayServer: this.config.gatewayServer,
      
      // äº‹ä»¶å›è°ƒ
      onMessage: this.config.onMessage,
      onStateChange: this.config.onStateChange,
      onVoiceStateChange: this.config.onVoiceStateChange,
      onNetworkInfo: this.config.onNetworkInfo,
      
      // å¼€å¯æ—¥å¿—ï¼ˆå¼€å‘æ—¶å»ºè®®å¼€å¯ï¼‰
      enableLogger: true
    })

    // åˆå§‹åŒ–SDKï¼ˆåŠ è½½èµ„æºï¼‰
    await this.sdk.init({
      onDownloadProgress: options?.onDownloadProgress
    })

    console.log('âœ… é­”çæ˜Ÿäº‘SDKåˆå§‹åŒ–æˆåŠŸ')
  }

  // è®©æ•°å­—äººè¯´è¯
  speak(text: string, isStart: boolean, isEnd: boolean) {
    if (!this.sdk) {
      throw new Error('SDKæœªåˆå§‹åŒ–')
    }
    this.sdk.speak(text, isStart, isEnd)
  }

  // åˆ‡æ¢åˆ°æ€è€ƒçŠ¶æ€
  think() {
    if (!this.sdk) return
    this.sdk.think()
  }

  // åˆ‡æ¢åˆ°å€¾å¬çŠ¶æ€
  listen() {
    if (!this.sdk) return
    this.sdk.listen()
  }

  // åˆ‡æ¢åˆ°å¾…æœºçŠ¶æ€
  interactiveidle() {
    if (!this.sdk) return
    this.sdk.interactiveidle()
  }

  // é”€æ¯SDK
  destroy() {
    if (this.sdk) {
      this.sdk.destroy()
      this.sdk = null
      console.log('âœ… SDKå·²é”€æ¯')
    }
  }
}
```

**ä»£ç è§£é‡Š**ï¼š

1. **é…ç½®æ¥å£å®šä¹‰**ï¼š
   - `XingyunConfig` å®šä¹‰äº†SDKæ‰€éœ€çš„æ‰€æœ‰é…ç½®å‚æ•°
   - ä½¿ç”¨TypeScriptæ¥å£ï¼Œæä¾›ç±»å‹æ£€æŸ¥å’Œä»£ç æç¤º

2. **ç±»å°è£…**ï¼š
   - å°†SDKæ“ä½œå°è£…ä¸ºç±»æ–¹æ³•ï¼Œä¾¿äºç®¡ç†å’Œè°ƒç”¨
   - `private sdk` ä¿å­˜SDKå®ä¾‹ï¼Œé¿å…å¤–éƒ¨ç›´æ¥è®¿é—®

3. **åˆå§‹åŒ–æ–¹æ³•**ï¼š
   - æ£€æŸ¥SDKæ˜¯å¦åŠ è½½ï¼ˆé˜²æ­¢å¿˜è®°å¼•å…¥scriptï¼‰
   - åˆ›å»ºSDKå®ä¾‹å¹¶é…ç½®å›è°ƒ
   - æ”¯æŒè¿›åº¦å›è°ƒï¼Œæå‡ç”¨æˆ·ä½“éªŒ

4. **çŠ¶æ€æ§åˆ¶æ–¹æ³•**ï¼š
   - `speak()`ï¼šè®©æ•°å­—äººè¯´è¯ï¼Œæ”¯æŒæµå¼è°ƒç”¨
   - `think()`ï¼šåˆ‡æ¢åˆ°æ€è€ƒçŠ¶æ€ï¼ˆæ€è€ƒåŠ¨ä½œï¼‰
   - `listen()`ï¼šåˆ‡æ¢åˆ°å€¾å¬çŠ¶æ€ï¼ˆå€¾å¬åŠ¨ä½œï¼‰
   - `interactiveidle()`ï¼šå›åˆ°å¾…æœºçŠ¶æ€

5. **èµ„æºç®¡ç†**ï¼š
   - `destroy()` ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾

---

#### 3.3.2 å¤§æ¨¡å‹æœåŠ¡å°è£…

åˆ›å»º `src/services/llm.ts`ï¼Œå¯¹æ¥å¤§æ¨¡å‹APIï¼š

```typescript
// src/services/llm.ts
export interface LLMConfig {
  model: string        // æ¨¡å‹åç§°
  apiKey: string       // APIå¯†é’¥
  baseURL?: string     // APIåŸºç¡€URL
}

export class LLMService {
  private config: LLMConfig
  private conversationHistory: Array<{ role: string; content: string }> = []

  constructor(config: LLMConfig) {
    this.config = config
    
    // æ ¹æ®æ¨¡å‹è‡ªåŠ¨è®¾ç½®baseURL
    if (!this.config.baseURL) {
      this.config.baseURL = this.getDefaultBaseURL(config.model)
    }
    
    // åˆå§‹åŒ–ç³»ç»Ÿæç¤ºè¯
    this.conversationHistory = [
      {
        role: 'system',
        content: this.getSystemPrompt()
      }
    ]
  }

  // æ ¹æ®æ¨¡å‹è·å–é»˜è®¤baseURL
  private getDefaultBaseURL(model: string): string {
    if (model.includes('deepseek')) {
      return 'https://api.deepseek.com'
    } else if (model.includes('doubao')) {
      return 'https://ark.cn-beijing.volces.com/api/v3'
    } else if (model.includes('qwen')) {
      return 'https://dashscope.aliyuncs.com/compatible-mode/v1'
    }
    return 'https://api.openai.com/v1'
  }

  // è·å–ç³»ç»Ÿæç¤ºè¯
  private getSystemPrompt(): string {
    return `ä½ æ˜¯ä¸€ä½è·¯æ¼”æ•°å­—äººæ´ªï¼Œä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆã€‚

ã€é‡è¦çº¦æŸã€‘ï¼š
1. æ¯æ¬¡åªå›å¤ä¸€æ®µè¯ï¼Œä¸èƒ½åˆ†å¤šæ®µ
2. å›å¤å†…å®¹ä¸èƒ½è¶…è¿‡50ä¸ªå­—
3. å¿…é¡»ä»¥å¥å·ï¼ˆã€‚ï¼‰ç»“å°¾
4. ç»å¯¹ä¸è¦ä½¿ç”¨ä»»ä½•è¡¨æƒ…ç¬¦å·ã€emojiã€ç‰¹æ®Šç¬¦å·
5. ä¸è¦ä½¿ç”¨æ¢è¡Œç¬¦ã€ä¸è¦åˆ†æ®µã€ä¸è¦ä½¿ç”¨åˆ—è¡¨
6. å¦‚æœå†…å®¹å¤ªå¤šï¼Œåªè¯´æœ€æ ¸å¿ƒçš„ä¸€å¥è¯
7. è¯­æ°”ç®€æ´ã€ä¸“ä¸šã€å‹å¥½

å›ç­”ç¤ºä¾‹ï¼š
é—®ï¼šä½ å¥½
ç­”ï¼šä½ å¥½ï¼Œæˆ‘æ˜¯æ´ªï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚

é—®ï¼šè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ç­”ï¼šæˆ‘æ˜¯è·¯æ¼”æ•°å­—äººæ´ªï¼Œå¯ä»¥å¸®æ‚¨åˆ†ææ•°æ®å’Œè§£ç­”é—®é¢˜ã€‚`
  }

  // æµå¼å‘é€æ¶ˆæ¯
  async sendStream(
    userMessage: string,
    onChunk: (chunk: string, done: boolean) => void
  ): Promise<void> {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²
    this.conversationHistory.push({
      role: 'user',
      content: userMessage
    })

    try {
      // ä½¿ç”¨fetchè¿›è¡Œæµå¼è¯·æ±‚
      const response = await fetch(`${this.config.baseURL}/chat/completions`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.config.apiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: this.config.model,
          messages: this.conversationHistory,
          stream: true  // å¼€å¯æµå¼å“åº”
        })
      })

      if (!response.ok) {
        const errorText = await response.text()
        throw new Error(`APIé”™è¯¯ ${response.status}: ${errorText}`)
      }

      // è·å–æµå¼å“åº”
      const reader = response.body?.getReader()
      if (!reader) {
        throw new Error('æ— æ³•è·å–å“åº”æµ')
      }

      const decoder = new TextDecoder()
      let assistantMessage = ''

      // æŒç»­è¯»å–æµ
      while (true) {
        const { done, value } = await reader.read()
        
        if (done) {
          // æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯åˆ°å†å²
          this.conversationHistory.push({
            role: 'assistant',
            content: assistantMessage
          })
          
          // é€šçŸ¥è°ƒç”¨æ–¹æµç»“æŸ
          onChunk('', true)
          break
        }

        // è§£ææµå¼æ•°æ®
        const chunk = decoder.decode(value, { stream: true })
        const lines = chunk.split('\n').filter(line => line.trim())

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6).trim()
            
            if (data === '[DONE]') continue

            try {
              const json = JSON.parse(data)
              const content = json.choices?.[0]?.delta?.content || ''
              
              if (content) {
                assistantMessage += content
                // æ¯æ¬¡æ”¶åˆ°chunkå°±é€šçŸ¥è°ƒç”¨æ–¹
                onChunk(content, false)
              }
            } catch (e) {
              console.error('è§£æJSONå¤±è´¥:', e)
            }
          }
        }
      }
    } catch (error: any) {
      console.error('LLMè¯·æ±‚å¤±è´¥:', error)
      throw error
    }
  }

  // æ¸…ç©ºå¯¹è¯å†å²
  clearHistory() {
    this.conversationHistory = [
      {
        role: 'system',
        content: this.getSystemPrompt()
      }
    ]
  }
}
```

**ä»£ç è§£é‡Š**ï¼š

1. **è‡ªåŠ¨é…ç½®baseURL**ï¼š
   - æ ¹æ®æ¨¡å‹åç§°è‡ªåŠ¨è¯†åˆ«APIåœ°å€
   - æ”¯æŒDeepSeekã€è±†åŒ…ã€é€šä¹‰åƒé—®ã€ChatGPTç­‰

2. **ç³»ç»Ÿæç¤ºè¯è®¾è®¡**ï¼š
   - å®šä¹‰AIè§’è‰²ä¸º"è·¯æ¼”æ•°å­—äººæ´ª"
   - ä¸¥æ ¼é™åˆ¶å›å¤æ ¼å¼ï¼ˆ50å­—ã€ä¸€æ®µè¯ã€å¥å·ç»“å°¾ï¼‰
   - ç¦æ­¢ä½¿ç”¨è¡¨æƒ…ç¬¦å·ï¼ˆç¡®ä¿æ•°å­—äººæ’­æŠ¥æµç•…ï¼‰

3. **æµå¼è¯·æ±‚å®ç°**ï¼š
   - ä½¿ç”¨ `fetch` + `ReadableStream` å®ç°
   - ä¸ä¾èµ–OpenAI SDKï¼Œæ›´çµæ´»
   - é€chunké€šçŸ¥è°ƒç”¨æ–¹ï¼Œå®ç°è¾¹ç”Ÿæˆè¾¹æ’­æ”¾

4. **å¯¹è¯å†å²ç®¡ç†**ï¼š
   - è‡ªåŠ¨ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡
   - æ”¯æŒå¤šè½®å¯¹è¯
   - æä¾›æ¸…ç©ºå†å²çš„æ–¹æ³•

---

### 3.4 æ ¸å¿ƒç»„ä»¶å¼€å‘

#### 3.4.1 æ•°å­—äººå±•ç¤ºç»„ä»¶

åˆ›å»º `src/components/AvatarPanel.vue`ï¼Œè¿™æ˜¯æœ€æ ¸å¿ƒçš„ç»„ä»¶ï¼š

```vue
<template>
  <div class="avatar-panel">
    <!-- åŠ è½½è¿›åº¦ -->
    <div v-if="loading" class="loading-overlay">
      <el-progress 
        type="circle" 
        :percentage="loadingProgress"
        :width="120"
      />
      <p>æ­£åœ¨åŠ è½½æ•°å­—äººèµ„æº...</p>
    </div>

    <!-- æ•°å­—äººå®¹å™¨ -->
    <div id="avatar-container" class="avatar-container"></div>

    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="status-bar">
      <el-tag :type="isConnected ? 'success' : 'info'">
        {{ isConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
      </el-tag>
      <el-tag v-if="networkInfo" type="info">
        å»¶è¿Ÿ: {{ networkInfo.rtt }}ms
      </el-tag>
    </div>

    <!-- å­—å¹•åŒºåŸŸ -->
    <div v-if="subtitle" class="subtitle-area">
      {{ subtitle }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onBeforeUnmount } from 'vue'
import { ElMessage } from 'element-plus'
import { XingyunService } from '../services/xingyun'
import { LLMService } from '../services/llm'

// Propså®šä¹‰
const props = defineProps<{
  config: {
    appId: string
    appSecret: string
    llmModel: string
    llmApiKey: string
  }
}>()

// Emitså®šä¹‰
const emit = defineEmits<{
  ready: []
  error: [error: any]
  message: [role: string, content: string]
}>()

// å“åº”å¼çŠ¶æ€
const loading = ref(true)
const loadingProgress = ref(0)
const isConnected = ref(false)
const subtitle = ref('')
const networkInfo = ref<any>(null)

// æœåŠ¡å®ä¾‹
let xingyunService: XingyunService | null = null
let llmService: LLMService | null = null

// åˆå§‹åŒ–
onMounted(async () => {
  try {
    // åˆ›å»ºæ˜Ÿäº‘æœåŠ¡
    xingyunService = new XingyunService({
      containerId: '#avatar-container',
      appId: props.config.appId,
      appSecret: props.config.appSecret,
      gatewayServer: 'https://nebula-agent.xingyun3d.com/user/v1/ttsa/session',
      
      // æ¶ˆæ¯å›è°ƒ
      onMessage: (message) => {
        console.log('SDKæ¶ˆæ¯:', message)
      },
      
      // çŠ¶æ€å˜åŒ–å›è°ƒ
      onStateChange: (state) => {
        console.log('çŠ¶æ€å˜åŒ–:', state)
      },
      
      // è¯­éŸ³çŠ¶æ€å›è°ƒ
      onVoiceStateChange: (status) => {
        if (status === 'start') {
          console.log('ğŸ¤ å¼€å§‹è¯´è¯')
        } else if (status === 'end') {
          console.log('ğŸ¤ è¯´è¯ç»“æŸ')
          // è¯´å®Œåå›åˆ°å¾…æœº
          xingyunService?.interactiveidle()
        }
      },
      
      // ç½‘ç»œä¿¡æ¯å›è°ƒ
      onNetworkInfo: (info) => {
        networkInfo.value = info
      }
    })

    // åˆå§‹åŒ–SDKï¼ˆå¸¦è¿›åº¦ï¼‰
    await xingyunService.init({
      onDownloadProgress: (progress) => {
        loadingProgress.value = progress
      }
    })

    // åˆ›å»ºLLMæœåŠ¡
    llmService = new LLMService({
      model: props.config.llmModel,
      apiKey: props.config.llmApiKey
    })

    loading.value = false
    isConnected.value = true
    emit('ready')

  } catch (error: any) {
    loading.value = false
    ElMessage.error(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`)
    emit('error', error)
  }
})

// å‘é€åˆ°LLMå¹¶é©±åŠ¨æ•°å­—äºº
const sendToLLM = async (text: string) => {
  if (!xingyunService || !llmService) {
    ElMessage.error('æœåŠ¡æœªåˆå§‹åŒ–')
    return
  }

  try {
    // åˆ‡æ¢åˆ°æ€è€ƒçŠ¶æ€
    xingyunService.think()

    // æµå¼æ¥æ”¶LLMå“åº”
    let fullResponse = ''
    
    await llmService.sendStream(text, (chunk: string, done: boolean) => {
      if (chunk) {
        fullResponse += chunk
        subtitle.value = fullResponse  // å®æ—¶æ›´æ–°å­—å¹•
      }

      // AIç”Ÿæˆç»“æŸï¼Œä¸€æ¬¡æ€§å‘é€ç»™æ•°å­—äºº
      if (done) {
        console.log('AIç”Ÿæˆå®Œæˆï¼Œæ€»å­—æ•°:', fullResponse.length)
        
        if (fullResponse.trim()) {
          // ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰å†…å®¹
          xingyunService!.speak(fullResponse, true, true)
        }
        
        // é€šçŸ¥çˆ¶ç»„ä»¶
        emit('message', 'assistant', fullResponse)
        
        // æ¸…ç©ºå­—å¹•ï¼ˆå»¶è¿Ÿæ¸…ç©ºï¼‰
        setTimeout(() => {
          subtitle.value = ''
        }, 3000)
      }
    })

  } catch (error: any) {
    ElMessage.error(`å¯¹è¯å¤±è´¥: ${error.message}`)
    xingyunService.interactiveidle()
  }
}

// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
defineExpose({
  sendToLLM
})

// æ¸…ç†
onBeforeUnmount(() => {
  xingyunService?.destroy()
})
</script>

<style scoped>
.avatar-panel {
  position: relative;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  overflow: hidden;
}

.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  z-index: 10;
}

.avatar-container {
  width: 100%;
  height: 100%;
}

.status-bar {
  position: absolute;
  top: 16px;
  right: 16px;
  display: flex;
  gap: 8px;
  z-index: 5;
}

.subtitle-area {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  max-width: 80%;
  padding: 12px 24px;
  background: rgba(0, 0, 0, 0.75);
  color: white;
  border-radius: 8px;
  font-size: 16px;
  text-align: center;
  z-index: 100;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}
</style>
```

**ä»£ç å…³é”®ç‚¹è§£é‡Š**ï¼š

1. **ç»„ä»¶ç»“æ„**ï¼š
   - åŠ è½½è¿›åº¦ï¼šæ˜¾ç¤ºèµ„æºä¸‹è½½è¿›åº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
   - æ•°å­—äººå®¹å™¨ï¼šSDKæ¸²æŸ“çš„ç›®æ ‡å®¹å™¨
   - çŠ¶æ€æŒ‡ç¤ºå™¨ï¼šæ˜¾ç¤ºè¿æ¥çŠ¶æ€å’Œç½‘ç»œå»¶è¿Ÿ
   - å­—å¹•åŒºåŸŸï¼šå®æ—¶æ˜¾ç¤ºAIç”Ÿæˆçš„å†…å®¹

2. **åˆå§‹åŒ–æµç¨‹**ï¼š
   ```
   åˆ›å»ºXingyunService â†’ åˆå§‹åŒ–SDKï¼ˆä¸‹è½½èµ„æºï¼‰â†’ åˆ›å»ºLLMService â†’ å®Œæˆ
   ```

3. **æ ¸å¿ƒæ–¹æ³• `sendToLLM`**ï¼š
   - æ¥æ”¶ç”¨æˆ·è¾“å…¥
   - åˆ‡æ¢æ•°å­—äººåˆ°æ€è€ƒçŠ¶æ€
   - æµå¼è°ƒç”¨LLMè·å–å“åº”
   - ç­‰å¾…å…¨éƒ¨ç”Ÿæˆå®Œæˆåä¸€æ¬¡æ€§å‘é€ç»™æ•°å­—äºº
   - å®æ—¶æ›´æ–°å­—å¹•

4. **çŠ¶æ€ç®¡ç†**ï¼š
   - `loading`ï¼šæ§åˆ¶åŠ è½½åŠ¨ç”»
   - `isConnected`ï¼šSDKè¿æ¥çŠ¶æ€
   - `subtitle`ï¼šå½“å‰å­—å¹•å†…å®¹
   - `networkInfo`ï¼šç½‘ç»œè´¨é‡ä¿¡æ¯

5. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼š
   - `onMounted`ï¼šç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–
   - `onBeforeUnmount`ï¼šç»„ä»¶å¸è½½æ—¶é”€æ¯SDK

---

#### 3.4.2 èŠå¤©å¯¹è¯ç»„ä»¶

åˆ›å»º `src/components/ChatPanel.vue`ï¼š

```vue
<template>
  <div class="chat-panel">
    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <div class="message-list" ref="messageListRef">
      <div
        v-for="(msg, index) in messages"
        :key="index"
        :class="['message-item', `message-${msg.role}`]"
      >
        <div class="message-avatar">
          <el-icon v-if="msg.role === 'user'" :size="24">
            <User />
          </el-icon>
          <el-icon v-else :size="24">
            <Avatar />
          </el-icon>
        </div>
        <div class="message-content">
          <div class="message-text">{{ msg.content }}</div>
          <div class="message-time">
            {{ formatTime(msg.timestamp) }}
          </div>
        </div>
      </div>

      <!-- åŠ è½½ä¸­ -->
      <div v-if="isLoading" class="message-item message-assistant">
        <div class="message-avatar">
          <el-icon :size="24"><Avatar /></el-icon>
        </div>
        <div class="message-content">
          <div class="message-text">æ€è€ƒä¸­...</div>
        </div>
      </div>
    </div>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="input-area">
      <el-input
        v-model="inputText"
        placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
        :disabled="isLoading || !isConnected"
        @keyup.enter="handleSend"
        class="input-box"
      >
        <template #append>
          <el-button
            type="primary"
            :loading="isLoading"
            :disabled="!inputText.trim() || !isConnected"
            @click="handleSend"
          >
            å‘é€
          </el-button>
        </template>
      </el-input>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch, nextTick } from 'vue'
import { User, Avatar } from '@element-plus/icons-vue'

// Props
const props = defineProps<{
  messages: Array<{
    role: string
    content: string
    timestamp: number
  }>
  isLoading: boolean
  isConnected: boolean
}>()

// Emits
const emit = defineEmits<{
  send: [text: string]
}>()

// å“åº”å¼æ•°æ®
const inputText = ref('')
const messageListRef = ref<HTMLElement>()

// å‘é€æ¶ˆæ¯
const handleSend = () => {
  if (!inputText.value.trim()) return
  
  emit('send', inputText.value)
  inputText.value = ''
}

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (timestamp: number) => {
  const date = new Date(timestamp)
  return date.toLocaleTimeString('zh-CN', {
    hour: '2-digit',
    minute: '2-digit'
  })
}

// è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
watch(() => props.messages.length, () => {
  nextTick(() => {
    if (messageListRef.value) {
      messageListRef.value.scrollTop = messageListRef.value.scrollHeight
    }
  })
})
</script>

<style scoped>
.chat-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.message-item {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

.message-user {
  flex-direction: row-reverse;
}

.message-avatar {
  flex-shrink: 0;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.message-content {
  max-width: 70%;
}

.message-text {
  padding: 12px 16px;
  border-radius: 12px;
  background: #f5f5f5;
  word-break: break-word;
}

.message-user .message-text {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.message-time {
  margin-top: 4px;
  font-size: 12px;
  color: #999;
}

.input-area {
  padding: 20px;
  border-top: 1px solid #eee;
  background: #fafafa;
}

.input-box {
  font-size: 16px;
}

.input-box :deep(.el-input__wrapper) {
  border-radius: 24px;
  padding: 8px 16px;
  border: 2px solid #667eea;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.input-box :deep(.el-input__wrapper:focus) {
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}
</style>
```

**ä»£ç å…³é”®ç‚¹**ï¼š

1. **æ¶ˆæ¯å±•ç¤º**ï¼š
   - ç”¨æˆ·æ¶ˆæ¯é å³ï¼Œè“è‰²èƒŒæ™¯
   - AIæ¶ˆæ¯é å·¦ï¼Œç°è‰²èƒŒæ™¯
   - æ˜¾ç¤ºå¤´åƒå’Œæ—¶é—´æˆ³

2. **è¾“å…¥æ§åˆ¶**ï¼š
   - æœªè¿æ¥æ—¶ç¦ç”¨è¾“å…¥
   - åŠ è½½ä¸­ç¦ç”¨å‘é€
   - æ”¯æŒå›è½¦å‘é€

3. **è‡ªåŠ¨æ»šåŠ¨**ï¼š
   - ä½¿ç”¨ `watch` ç›‘å¬æ¶ˆæ¯å˜åŒ–
   - è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯

---

### 3.5 ä¸»åº”ç”¨ç»„ä»¶æ•´åˆ

æœ€åï¼Œåœ¨ `src/App.vue` ä¸­æ•´åˆæ‰€æœ‰ç»„ä»¶ï¼š

```vue
<template>
  <div class="app-container">
    <div class="header">
      <h1>ğŸ¤– AI BIåˆ†æå¸ˆ - é­”çæ˜Ÿäº‘</h1>
      <el-button @click="showSettings = true">é…ç½®</el-button>
    </div>

    <div class="main-content">
      <!-- å·¦ä¾§ï¼šæ•°å­—äºº -->
      <div class="left-panel">
        <AvatarPanel
          ref="avatarPanelRef"
          :config="sdkConfig"
          @ready="handleAvatarReady"
          @error="handleAvatarError"
          @message="handleAvatarMessage"
        />
      </div>

      <!-- å³ä¾§ï¼šèŠå¤© -->
      <div class="right-panel">
        <ChatPanel
          :messages="messages"
          :is-loading="isLoading"
          :is-connected="isConnected"
          @send="handleSendMessage"
        />
      </div>
    </div>

    <!-- é…ç½®å¼¹çª— -->
    <el-dialog v-model="showSettings" title="é…ç½®">
      <SettingsForm
        :config="sdkConfig"
        @save="handleSaveSettings"
      />
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import AvatarPanel from './components/AvatarPanel.vue'
import ChatPanel from './components/ChatPanel.vue'
import SettingsForm from './components/SettingsForm.vue'

// çŠ¶æ€
const showSettings = ref(false)
const isConnected = ref(false)
const isLoading = ref(false)
const messages = ref<Array<any>>([])

// é…ç½®ï¼ˆä»localStorageè¯»å–ï¼‰
const sdkConfig = ref({
  appId: localStorage.getItem('xingyun_appId') || '',
  appSecret: localStorage.getItem('xingyun_appSecret') || '',
  llmModel: localStorage.getItem('llm_model') || 'deepseek-chat',
  llmApiKey: localStorage.getItem('llm_apiKey') || ''
})

// ç»„ä»¶å¼•ç”¨
const avatarPanelRef = ref<InstanceType<typeof AvatarPanel>>()

// æ•°å­—äººå°±ç»ª
const handleAvatarReady = () => {
  isConnected.value = true
  ElMessage.success('æ•°å­—äººå·²å°±ç»ª')
}

// æ•°å­—äººé”™è¯¯
const handleAvatarError = (error: any) => {
  ElMessage.error(`æ•°å­—äººé”™è¯¯: ${error.message}`)
  isLoading.value = false
}

// æ•°å­—äººæ¶ˆæ¯
const handleAvatarMessage = (role: string, content: string) => {
  messages.value.push({
    role,
    content,
    timestamp: Date.now()
  })
  isLoading.value = false
}

// å‘é€æ¶ˆæ¯
const handleSendMessage = async (text: string) => {
  if (!text.trim() || !isConnected.value || isLoading.value) return

  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  messages.value.push({
    role: 'user',
    content: text,
    timestamp: Date.now()
  })

  isLoading.value = true

  // è°ƒç”¨å¤§æ¨¡å‹å¹¶é©±åŠ¨æ•°å­—äºº
  try {
    await avatarPanelRef.value?.sendToLLM(text)
  } catch (error) {
    isLoading.value = false
  }
}

// ä¿å­˜é…ç½®
const handleSaveSettings = (config: any) => {
  localStorage.setItem('xingyun_appId', config.appId)
  localStorage.setItem('xingyun_appSecret', config.appSecret)
  localStorage.setItem('llm_model', config.llmModel)
  localStorage.setItem('llm_apiKey', config.llmApiKey)
  
  sdkConfig.value = config
  showSettings.value = false
  
  ElMessage.success('é…ç½®å·²ä¿å­˜ï¼Œè¯·åˆ·æ–°é¡µé¢')
}
</script>

<style scoped>
.app-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f5f7fa;
}

.header {
  padding: 20px;
  background: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.main-content {
  flex: 1;
  display: flex;
  gap: 20px;
  padding: 20px;
  overflow: hidden;
}

.left-panel {
  flex: 1;
  min-width: 400px;
}

.right-panel {
  flex: 1;
  min-width: 400px;
}
</style>
```

**æ•´åˆå…³é”®ç‚¹**ï¼š

1. **ç»„ä»¶é€šä¿¡**ï¼š
   - ä½¿ç”¨ `ref` è·å–å­ç»„ä»¶å®ä¾‹
   - é€šè¿‡ `emit` æ¥æ”¶å­ç»„ä»¶äº‹ä»¶
   - ä½¿ç”¨ `props` ä¼ é€’é…ç½®å’ŒçŠ¶æ€

2. **çŠ¶æ€ç®¡ç†**ï¼š
   - `isConnected`ï¼šSDKè¿æ¥çŠ¶æ€
   - `isLoading`ï¼šæ¶ˆæ¯åŠ è½½çŠ¶æ€
   - `messages`ï¼šå¯¹è¯å†å²
   - `sdkConfig`ï¼šSDKé…ç½®

3. **é…ç½®æŒä¹…åŒ–**ï¼š
   - ä½¿ç”¨ `localStorage` ä¿å­˜é…ç½®
   - é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤

---

### 3.6 è¿è¡Œæ•ˆæœ

å®Œæˆä»¥ä¸Šä»£ç åï¼Œè¿è¡Œé¡¹ç›®ï¼š

```bash
npm run dev
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173`ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

[å›¾ç‰‡]

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
1. âœ… å·¦ä¾§3Dæ•°å­—äººå®æ—¶æ¸²æŸ“
2. âœ… å³ä¾§èŠå¤©ç•Œé¢æµç•…äº¤äº’
3. âœ… æ”¯æŒæ–‡æœ¬å¯¹è¯
4. âœ… AIç”Ÿæˆå†…å®¹å®æ—¶å­—å¹•
5. âœ… æ•°å­—äººåŒæ­¥è¡¨æƒ…åŠ¨ä½œ
6. âœ… ç½‘ç»œçŠ¶æ€å®æ—¶æ˜¾ç¤º

---

### 3.7 ä»£ç äº®ç‚¹æ€»ç»“

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å‘ç°é­”çæ˜Ÿäº‘SDKçš„å‡ ä¸ªä¼˜ç§€è®¾è®¡ï¼š

1. **APIè®¾è®¡ç®€æ´**ï¼š
   - `speak(text, isStart, isEnd)` ä¸€ä¸ªæ–¹æ³•æå®šè¯­éŸ³æ’­æ”¾
   - çŠ¶æ€åˆ‡æ¢æ–¹æ³•ç›´è§‚æ˜“æ‡‚

2. **å›è°ƒæœºåˆ¶å®Œå–„**ï¼š
   - `onVoiceStateChange` ç²¾ç¡®æ§åˆ¶æ’­æ”¾æ—¶æœº
   - `onNetworkInfo` å®æ—¶ç›‘æ§ç½‘ç»œè´¨é‡

3. **èµ„æºç®¡ç†ä¼˜é›…**ï¼š
   - è‡ªåŠ¨ä¸‹è½½å’Œç¼“å­˜èµ„æº
   - æ”¯æŒè¿›åº¦å›è°ƒ
   - é”€æ¯æ–¹æ³•ç¡®ä¿èµ„æºé‡Šæ”¾

4. **æ€§èƒ½è¡¨ç°ä¼˜ç§€**ï¼š
   - ç«¯ä¾§æ¸²æŸ“ï¼Œæ— äº‘ç«¯GPUæˆæœ¬
   - ä½å»¶æ—¶ï¼Œæ”¯æŒå®æ—¶æ‰“æ–­
   - èµ„æºå ç”¨åˆç†

---

### 3.8 å¼€å‘è¿‡ç¨‹ä¸­çš„å‘ä¸è§£å†³æ–¹æ¡ˆ

#### å‘1ï¼šæ•°å­—äººè¯´è¯è¢«æ‰“æ–­

**é—®é¢˜**ï¼šä½¿ç”¨å›ºå®šå»¶æ—¶ `setTimeout(1000)` åˆ‡æ¢çŠ¶æ€ï¼Œå¯¼è‡´æ’­æ”¾è¢«æ‰“æ–­ã€‚

**è§£å†³**ï¼šç›‘å¬ `onVoiceStateChange('end')` äº‹ä»¶ï¼Œç­‰å¾…çœŸæ­£è¯´å®Œå†åˆ‡æ¢ã€‚

```typescript
// âŒ é”™è¯¯åšæ³•
xingyunService.speak(text, true, true)
setTimeout(() => {
  xingyunService.interactiveidle()
}, 1000)

// âœ… æ­£ç¡®åšæ³•
onVoiceStateChange: (status) => {
  if (status === 'end') {
    xingyunService.interactiveidle()
  }
}
```

---

#### å‘2ï¼šAIå›å¤å¤ªé•¿å¯¼è‡´æ’­æ”¾å¡é¡¿

**é—®é¢˜**ï¼šAIä¸€æ¬¡æ€§ç”Ÿæˆ200å­—ï¼Œæ•°å­—äººè¯´å¤ªä¹…ã€‚

**è§£å†³**ï¼šåœ¨ç³»ç»Ÿæç¤ºè¯ä¸­é™åˆ¶å›å¤é•¿åº¦ï¼ˆ50å­—ä»¥å†…ï¼‰ã€‚

```typescript
systemPrompt: `
  ã€é‡è¦çº¦æŸã€‘ï¼š
  1. å›å¤å†…å®¹ä¸èƒ½è¶…è¿‡50ä¸ªå­—
  2. å¿…é¡»ä»¥å¥å·ï¼ˆã€‚ï¼‰ç»“å°¾
  ...
`
```

---

#### å‘3ï¼šè¡¨æƒ…ç¬¦å·å¯¼è‡´æ’­æ”¾å¼‚å¸¸

**é—®é¢˜**ï¼šAIç”Ÿæˆçš„è¡¨æƒ…ç¬¦å·ï¼ˆğŸ˜Šï¼‰æ— æ³•æ­£ç¡®æ’­æ”¾ã€‚

**è§£å†³**ï¼š
1. åœ¨ç³»ç»Ÿæç¤ºè¯ä¸­ç¦æ­¢è¡¨æƒ…
2. å‰ç«¯è¿‡æ»¤è¡¨æƒ…ç¬¦å·

```typescript
const removeEmojis = (text: string): string => {
  return text
    .replace(/[\u{1F600}-\u{1F64F}]/gu, '')
    .replace(/[\u{1F300}-\u{1F5FF}]/gu, '')
    // ... æ›´å¤šUnicodeèŒƒå›´
    .trim()
}
```

---

