# 文本输入对话功能使用说明

## ✅ 功能状态

文本对话功能已完整实现，支持：
- ✅ 用户输入文本消息
- ✅ 大模型流式响应
- ✅ 数字人语音播报
- ✅ 消息历史记录
- ✅ 状态同步显示

---

## 🚀 快速开始

### 1. 启动项目

```bash
npm run dev
```

访问：`http://localhost:5173`

### 2. 配置参数

首次访问会弹出配置对话框，需要填写：

#### 必填项：

**魔珐星云配置**
- App ID：从 [魔珐星云平台](https://xingyun3d.com/) 获取
- App Secret：与 App ID 一起获取

**大模型配置**
- 模型：选择 `doubao-pro-32k`（推荐）
- API Key：从 [火山引擎](https://console.volcengine.com/ark) 获取

> 💡 提示：如果没有 API Key，可以先注册账号并创建推理接入点。

### 3. 开始对话

配置完成后，刷新页面即可开始使用！

---

## 📝 使用方法

### 方法1：在聊天面板输入

1. **找到聊天面板**（右侧上方）
2. **在输入框中输入问题**，例如：
   ```
   你好，请介绍一下自己
   ```
3. **按 `Ctrl + Enter` 或点击"发送"按钮**
4. **等待AI回复**
   - 数字人会先进入"思考"状态
   - 然后开始说话并显示文字
   - 字幕会实时显示在数字人下方

### 方法2：使用快捷操作

在控制面板（右侧下方）点击快捷按钮：

- 🌟 **自我介绍** - "你好，请介绍一下自己"
- 📊 **数据分析** - "帮我分析一下最近的销售数据"
- 📈 **趋势图表** - "展示销售趋势图表"
- 📄 **生成报告** - "生成数据报告"

---

## 🎯 对话流程详解

### 完整流程：

```
1. 用户输入文本
   ↓
2. 消息添加到对话历史
   ↓
3. 数字人切换到"思考"状态 🤔
   ↓
4. 调用大模型API（流式）
   ↓
5. 首次积攒20-30字后开始播放 🎤
   ↓
6. 后续每10字发送一次
   ↓
7. 数字人说话并显示字幕
   ↓
8. 完成后回到"待机"状态 😊
```

### 技术实现：

```typescript
// 1. 切换到思考状态
xingyunService.think()

// 2. 流式调用LLM
let isFirst = true
let buffer = ''

await llmService.sendStream(userMessage, (chunk, done) => {
  buffer += chunk
  
  // 首次积攒20-30字
  if (isFirst && buffer.length >= 20) {
    xingyunService.speak(buffer, true, false)
    buffer = ''
    isFirst = false
  }
  // 后续每10字发送一次
  else if (!isFirst && buffer.length >= 10) {
    xingyunService.speak(buffer, false, false)
    buffer = ''
  }
  
  // 最后一次
  if (done && buffer) {
    xingyunService.speak(buffer, isFirst, true)
  }
})

// 3. 回到待机状态
setTimeout(() => {
  xingyunService.interactiveidle()
}, 1000)
```

---

## 💡 对话示例

### 示例1：基础对话

**你：** 你好

**AI：** 你好！我是洪，你的路演数字人洪。我可以帮助你分析数据、生成报告、制作图表。有什么我可以帮助你的吗？

---

### 示例2：自我介绍

**你：** 你好，请介绍一下自己

**AI：** 你好！我是洪，一位路演数字人洪。我的职责是帮助用户分析业务数据，提供专业的数据洞察。我可以：
1. 分析各类业务数据并提供专业见解
2. 用简洁易懂的语言解释数据趋势
3. 生成可视化图表帮助理解数据
4. 制作专业的数据分析报告

我会保持友好、专业的态度，随时为您服务！

---

### 示例3：数据分析

**你：** 帮我分析一下本月的销售数据

**AI：** 好的，让我为您分析本月的销售数据。根据数据显示：

**总体情况：**
- 本月销售额：¥1,234,567
- 环比增长：+15.3%
- 同比增长：+28.7%

**关键发现：**
1. 销售额持续增长，表现优异
2. 产品A销量最高，占比42%
3. 华东地区增长最快，达+35%

**建议：**
- 加大产品A的市场投入
- 复制华东地区的成功经验到其他地区

您还想了解更详细的信息吗？

---

### 示例4：生成图表

**你：** 请展示最近三个月的销售趋势图

**AI：** 好的，我为您生成了销售趋势图。从图表可以看出：

📈 **趋势分析：**
- 9月：¥980,000 
- 10月：¥1,120,000 (+14.3%)
- 11月：¥1,234,567 (+10.2%)

**结论：** 销售额呈现稳定上升趋势，增长态势良好。

[注：实际项目中可以集成 ECharts 显示真实图表]

---

## 🎮 界面功能说明

### 左侧：数字人面板

- **3D数字人**：实时渲染和动作
- **状态指示器**：显示"已连接"/"说话中"等状态
- **字幕区域**：显示当前说话内容
- **网络信息**：延迟、下载速率等
- **调试按钮**：显示/隐藏技术信息

### 右侧上方：聊天面板

- **消息列表**：显示对话历史
  - 蓝色气泡：用户消息
  - 灰色气泡：AI回复
- **输入框**：输入问题
- **发送按钮**：发送消息
- **清空按钮**：清空对话历史

### 右侧下方：控制面板

- **状态展示**：连接、说话、听取状态
- **操作按钮**：
  - 开始语音输入
  - 停止语音输入
  - 打断说话
- **快捷操作**：预设问题快速发送
- **使用提示**：功能说明

---

## ⚙️ 高级功能

### 1. 打断说话

如果数字人说话太长，可以随时打断：
1. 点击"打断说话"按钮
2. 数字人立即停止
3. 可以发送新的消息

### 2. 清空对话

清空所有对话记录：
1. 点击聊天面板右上角的"清空"按钮
2. 确认后清空所有消息

### 3. 快捷键

- `Ctrl + Enter`：发送消息（在输入框中）

### 4. 调试模式

点击"显示调试信息"可以查看：
- 帧率（FPS）
- 渲染性能
- 网络状态
- SDK版本

---

## 🔍 状态说明

### 数字人状态

| 状态 | 说明 | 图标颜色 |
|------|------|---------|
| 已连接 | 数字人正常运行 | 🟢 绿色 |
| 未连接 | 数字人未初始化 | ⚪ 灰色 |
| 待机中 | 等待用户输入 | 🟢 绿色 |
| 说话中 | 正在回答问题 | 🔵 蓝色 |

### 对话状态

| 状态 | 说明 |
|------|------|
| 等待输入 | 可以发送新消息 |
| 思考中... | 正在调用大模型 |
| 回复中 | 数字人正在说话 |

---

## ❗ 常见问题

### Q1: 数字人不说话？

**检查清单：**
- [ ] 配置是否正确填写
- [ ] API Key 是否有效
- [ ] 账户余额是否充足
- [ ] 浏览器音量是否开启
- [ ] 网络连接是否正常

**解决方法：**
1. 刷新页面重新连接
2. 检查浏览器控制台的错误信息
3. 重新配置参数

### Q2: 响应很慢？

**可能原因：**
- 网络延迟较高
- 大模型服务繁忙
- API额度不足

**优化方法：**
1. 检查网络延迟（查看网络信息面板）
2. 尝试切换其他大模型
3. 检查API额度

### Q3: 消息发送不出去？

**检查：**
- [ ] 是否已连接数字人（状态为"已连接"）
- [ ] 输入框是否为空
- [ ] 是否有正在进行的对话（等待上一次完成）

### Q4: 字幕不显示？

**可能原因：**
- Widget事件未正确配置
- 浏览器兼容性问题

**解决方法：**
- 刷新页面
- 查看控制台错误
- 尝试其他浏览器

---

## 🎨 自定义配置

### 修改系统提示词

编辑 `src/services/llm.ts`：

```typescript
systemPrompt: `你是一位路演数字人洪，专业的数据分析师。
你的职责是：
1. 帮助用户分析业务数据
2. 提供专业的数据洞察
3. 用简洁、专业但易懂的语言解释

回答要求：
- 简洁明了
- 突出关键数据
- 适当使用可视化
- 语气专业但友好`
```

### 修改流式发送策略

编辑 `src/components/AvatarPanel.vue`：

```typescript
// 调整首次积攒字数（默认20）
if (isFirst && buffer.length >= 30) {  // 改为30
  xingyunService!.speak(buffer, true, false)
  // ...
}

// 调整后续发送间隔（默认10）
else if (!isFirst && buffer.length >= 15) {  // 改为15
  xingyunService!.speak(buffer, false, false)
  // ...
}
```

### 添加更多快捷操作

编辑 `src/components/ControlPanel.vue`：

```vue
<el-button 
  :icon="YourIcon"
  @click="sendQuickMessage('你的问题')"
  :disabled="!isConnected"
>
  按钮名称
</el-button>
```

---

## 📊 性能优化

### 1. 减少延迟

- ✅ 使用流式输出（已实现）
- ✅ 首次积攒足够文本
- ✅ 选择响应快的大模型

### 2. 节省积分

- ✅ 使用基础音色（开发时）
- ✅ 不用时切换离线模式
- ✅ 避免频繁刷新

### 3. 优化体验

- ✅ 合理的文本分段
- ✅ 自然的状态切换
- ✅ 友好的错误提示

---

## 🔗 相关文档

- [快速启动.md](./快速启动.md) - 5分钟快速上手
- [接入指南.md](./接入指南.md) - 详细的技术文档
- [配置说明.md](./配置说明.md) - 参数配置指南
- [项目说明.md](./项目说明.md) - 项目架构说明

---

## 🎉 开始使用

现在你已经了解了文本对话功能的所有使用方法，快去尝试吧！

**推荐的第一个问题：**
```
你好，请介绍一下自己
```

祝使用愉快！🚀

